

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Creating web views for summaries &mdash; EspressoDB 0.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="More complicated tables" href="inheritance.html" />
    <link rel="prev" title="Adding tables with relationships" href="dependencies.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> EspressoDB
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../README.html">EspressoDB</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../README.html#what-does-espressodb-provide">What does EspressoDB provide?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../README.html#how-to-install-it">How to install it?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../README.html#what-s-the-story-behind-it">What’s the story behind it?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../README.html#who-is-responsible-for-it">Who is responsible for it?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../Usage.html">How to use EspressoDB</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Usage.html#tl-dr">TL;DR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Usage.html#details">Details</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../Usage.html#install-espressodb">Install EspressoDB</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Usage.html#start-a-project">Start a project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Usage.html#configure-your-project">Configure your project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Usage.html#create-or-update-the-database">Create or update the database</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Usage.html#launch-a-local-web-app">Launch a local web app</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Usage.html#create-a-new-app">Create a new app</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Usage.html#install-your-project-locally">Install your project locally</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">The example project</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../project-viewcase/index.html">What can I do?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../project-viewcase/install.html">Install the project</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project-viewcase/public-views.html">The public views</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project-viewcase/private-views.html">The private views</a></li>
<li class="toctree-l3"><a class="reference internal" href="../project-viewcase/external-scripts.html">Using your project in external modules</a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">How do I set up the example project myself?</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="project-creation.html">Create your own project</a></li>
<li class="toctree-l3"><a class="reference internal" href="app-creation.html">Create the hamiltonians app</a></li>
<li class="toctree-l3"><a class="reference internal" href="adding-data.html">Adding data</a></li>
<li class="toctree-l3"><a class="reference internal" href="class-interface.html">Providing short cuts with class methods</a></li>
<li class="toctree-l3"><a class="reference internal" href="dependencies.html">Adding tables with relationships</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Creating web views for summaries</a></li>
<li class="toctree-l3"><a class="reference internal" href="inheritance.html">More complicated tables</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../features/index.html">Features</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../features/base.html">Base</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../features/documentation.html">Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../features/management.html">Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../features/notifications.html">The notifications module</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">API Reference of EspressoDB</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../api/base/index.html">espressodb.base</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/base/models.html">models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/base/static.html">static</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/base/templates.html">templates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/base/templatetags.html">templatetags</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/base/utilities.html">utilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/base/views.html">views</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/documentation/index.html">espressodb.documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/documentation/templates.html">templates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/documentation/templatetags.html">templatetags</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/documentation/views.html">views</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/notifications/index.html">espressodb.notifications</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/notifications/models.html">models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/notifications/templates.html">templates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/notifications/templatetags.html">templatetags</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/notifications/views.html">views</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../api/management/index.html">espressodb.management</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../api/management/management.html">management</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../api/management/utilities.html">utilities</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">EspressoDB</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">The example project</a> &raquo;</li>
        
          <li><a href="index.html">How do I set up the example project myself?</a> &raquo;</li>
        
      <li>Creating web views for summaries</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/example/project-creation/views.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="creating-web-views-for-summaries">
<h1>Creating web views for summaries<a class="headerlink" href="#creating-web-views-for-summaries" title="Permalink to this headline">¶</a></h1>
<p>Views are Python objects which provide information for html templates.
E.g., they query the database and return strings to be rendered in your browser.
When you enter an url in your browser, django figures out which Python object to call which knows which template to render.</p>
<p>EspressoDB implements default views like the project homepage called which is rendered by the <code class="docutils literal notranslate"><span class="pre">index.html</span></code> template.</p>
<div class="section" id="adjusting-the-index-template">
<h2>Adjusting the index template<a class="headerlink" href="#adjusting-the-index-template" title="Permalink to this headline">¶</a></h2>
<p>When looking for the index template, django first checks your project tempalte directories, e.g., <code class="docutils literal notranslate"><span class="pre">my_project/hamiltonian/templates/</span></code> and then enters EspressoDB’s template dirs.
It renders the first template which matches the specification.
Thus, when you create <code class="docutils literal notranslate"><span class="pre">my_project/hamiltonian/templates/index.html</span></code>, you will overwrite the default index page.</p>
<p>Here is an example of how to overwrite the index page.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="n">extends</span> <span class="s1">&#39;base.html&#39;</span> <span class="o">%</span><span class="p">}</span>

<span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">content</span> <span class="o">%</span><span class="p">}</span>
<span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;jumbotron&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">Welcome</span> <span class="n">to</span> <span class="n">my</span> <span class="n">Project</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">h5</span><span class="o">&gt;</span><span class="n">This</span> <span class="n">page</span> <span class="ow">is</span> <span class="n">generated</span> <span class="n">by</span> <span class="n">the</span> <span class="n">template</span> <span class="o">&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">my_project</span><span class="o">/</span><span class="n">hamiltonian</span><span class="o">/</span><span class="n">templates</span><span class="o">/</span><span class="n">index</span><span class="o">.</span><span class="n">html</span><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;</span> <span class="n">view</span><span class="o">&lt;/</span><span class="n">h2</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>
        <span class="n">See</span> <span class="n">also</span> <span class="n">the</span>
        <span class="o">&lt;</span><span class="n">a</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;https://docs.djangoproject.com/en/2.2/ref/templates/language/&quot;</span><span class="o">&gt;</span>
            <span class="n">the</span> <span class="n">django</span> <span class="n">template</span> <span class="n">documentation</span>
        <span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
        <span class="n">how</span> <span class="n">templates</span> <span class="n">work</span><span class="o">.</span>
    <span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">{</span><span class="o">%</span> <span class="n">lorem</span> <span class="o">%</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endblock</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>This will adjust the index page to
<img alt="The new index page" src="../../_images/example-create-new-index.png" /></p>
<p>Content with <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">...</span> <span class="pre">%}</span></code> or <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">...</span> <span class="pre">}}</span></code> will be parsed by the view.
E.g., <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">...</span> <span class="pre">%}</span></code> denote template tags which can be loops, if statements and more.
The <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">...</span> <span class="pre">}}</span></code> templates will render variables.</p>
<p>Most importantly, for this template are the texts <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">extends</span> <span class="pre">'base.html'</span> <span class="pre">%}</span></code>, which tells that it should use the <code class="docutils literal notranslate"><span class="pre">base.html</span></code> template and extend it.
Thus the link navbar and further html content will be present without you not having to write anything.
The <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">block</span> <span class="pre">content</span> <span class="pre">%}</span></code> and <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">endblock</span> <span class="pre">%}</span></code> denotes that within the <code class="docutils literal notranslate"><span class="pre">base.html</span></code> template, the content between the same exact blocks will be replace with what you want to render.</p>
<p>See also <a class="reference external" href="https://docs.djangoproject.com/en/dev/ref/templates/language/">the django docs for more information on templates</a>.</p>
<p>Last but not least, EspressoDB comes with a few default css and javascript packages like <a class="reference external" href="https://katex.org">KaTeX</a> to render equations and <a class="reference external" href="https://getbootstrap.com/docs/4.0/getting-started/introduction/">Bootstrap 4</a> for having nice looking responsive webpages with minimal effort.</p>
</div>
<div class="section" id="views-with-plots">
<h2>Views with plots<a class="headerlink" href="#views-with-plots" title="Permalink to this headline">¶</a></h2>
<p>A nice feature of the Python backend is that you can directly export your plots to a homepage.
Whenever new data is added, your plot is dynamically updated.
So a possible plot page for this project would be a status view which summaries for which Hamiltonian all of the eigenvalues have been computed and which computations need to be repeated.</p>
<p>It is possible to just use matplotlib, store images dynamically and display them in your view.
In this example we have decided to use <a class="reference external" href="https://bokeh.pydata.org/en/latest/">Bokeh</a> as it allows to have dynamic plots, which allow to, e.g., to zoomi, or use mouse over effects on the web view (without storing images in an intermediate step).</p>
<p>To prepare the usage, you should install</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install bokeh
</pre></div>
</div>
<p>It is good practice to place all dependencies in the project <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code> file as well.</p>
<div class="section" id="creating-a-template-view">
<h3>Creating a template view<a class="headerlink" href="#creating-a-template-view" title="Permalink to this headline">¶</a></h3>
<p>We first start with setting up the view</p>
<p>Within the <code class="docutils literal notranslate"><span class="pre">my_project/hamiltonian/views.py</span></code> add the following lines</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.views.generic.base</span> <span class="kn">import</span> <span class="n">TemplateView</span>

<span class="kn">from</span> <span class="nn">my_project.hamiltonian.models</span> <span class="kn">import</span> <span class="n">Contact</span> <span class="k">as</span> <span class="n">ContactHamiltonian</span>

<span class="k">class</span> <span class="nc">HamiltonianStatusView</span><span class="p">(</span><span class="n">TemplateView</span><span class="p">):</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;status.html&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">ContactHamiltonian</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>

        <span class="k">return</span> <span class="n">context</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">TemplateView</span></code> class is a class with streamlines generating views.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">template_name</span> <span class="pre">=</span> <span class="pre">&quot;status.html&quot;</span></code> tells django to look for a file called <code class="docutils literal notranslate"><span class="pre">status.html</span></code> to render this view</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">get_context_data</span></code> method provides additional information to the rendering. E.g., that the model we are using is a <code class="docutils literal notranslate"><span class="pre">ContactHamiltonian</span></code>.
We overload the default method to guarantee that we do not eliminate other needed infromation.</p></li>
</ul>
</div>
<div class="section" id="creating-the-template">
<h3>Creating the template<a class="headerlink" href="#creating-the-template" title="Permalink to this headline">¶</a></h3>
<p>Next we actually have to create the to be rendered template.
To do so, create the file <code class="docutils literal notranslate"><span class="pre">my_project/hamiltonian/templates/status.html</span></code> and add the following code</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>{% extends &#39;base.html&#39; %}

{% block content %}
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;jumbotron&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;&lt;</span><span class="nt">code</span><span class="p">&gt;</span>{{model}}<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span> Status<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h5</span><span class="p">&gt;</span>This page summarizes the status of <span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span>{{model}}<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span> computations<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
        A job is considered done if, for given parameters, one has as many eigenvalues stored in the database as one has sites.
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{% endblock %}
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">{{model}}</span></code> now make use of the <code class="docutils literal notranslate"><span class="pre">context</span></code> parameter we have added (and will be rendered by the <code class="docutils literal notranslate"><span class="pre">str(ContactHamiltonian)</span></code> Python method).</p>
</div>
<div class="section" id="update-the-urls">
<h3>Update the urls<a class="headerlink" href="#update-the-urls" title="Permalink to this headline">¶</a></h3>
<p>To view this page online, we have to let django know where to find it.
This is done by adjusting <code class="docutils literal notranslate"><span class="pre">my_project/hamiltonian/urls.py</span></code> to include the following lines</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">my_project.hamiltonian.views</span> <span class="kn">import</span> <span class="n">HamiltonianStatusView</span>

<span class="n">app_name</span> <span class="o">=</span> <span class="s2">&quot;hamiltonian&quot;</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span><span class="n">path</span><span class="p">(</span><span class="s2">&quot;status/&quot;</span><span class="p">,</span> <span class="n">HamiltonianStatusView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;status&quot;</span><span class="p">)]</span>
</pre></div>
</div>
<p>E.g., when you visit <a class="reference external" href="http://127.0.0.1:8000/hamiltonian/status/">http://127.0.0.1:8000/hamiltonian/status/</a>, the <code class="docutils literal notranslate"><span class="pre">HamiltonianStatusView.as_view()</span></code> method is called, which renders the template.</p>
<p>By default, EspressoDB scans all your app directories and adds links to the navbar.
Thus, you should now be able to obtain the following web view
<img alt="The new hamiltonian status view" src="../../_images/example-create-hamiltonian-status-1.png" /></p>
</div>
<div class="section" id="preparing-data">
<h3>Preparing data<a class="headerlink" href="#preparing-data" title="Permalink to this headline">¶</a></h3>
<p>Next we want to prepare data for the status view</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>

<span class="kn">from</span> <span class="nn">my_project.hamiltonian.models</span> <span class="kn">import</span> <span class="n">Eigenvalue</span>

<span class="k">class</span> <span class="nc">HamiltonianStatusView</span><span class="p">(</span><span class="n">TemplateView</span><span class="p">):</span>

    <span class="o">...</span>

    <span class="k">def</span> <span class="nf">prepare_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;DataFrame&quot;</span><span class="p">:</span>
        <span class="n">hamiltonians</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

        <span class="n">eigenvalues</span> <span class="o">=</span> <span class="n">Eigenvalue</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">hamiltonian__in</span><span class="o">=</span><span class="n">hamiltonians</span><span class="p">)</span>

        <span class="n">level_count</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">eigenvalues</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(</span><span class="n">fieldnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;hamiltonian__id&quot;</span><span class="p">,</span> <span class="s2">&quot;n_level&quot;</span><span class="p">])</span>
            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;hamiltonian__id&quot;</span><span class="p">:</span> <span class="s2">&quot;id&quot;</span><span class="p">})</span>
            <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
            <span class="o">.</span><span class="n">count</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">hamiltonians</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(</span><span class="n">fieldnames</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;spacing&quot;</span><span class="p">,</span> <span class="s2">&quot;n_sites&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">])</span>
            <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">level_count</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;done&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;n_sites&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;n_level&quot;</span><span class="p">]</span>

        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">color</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">done</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
<p>By default EspressoDB queries can be <a class="reference external" href="https://github.com/chrisdev/django-pandas">converted to pandas DataFrames using django-pandas</a> this simplifies the logic of this code:</p>
<ol class="simple">
<li><p>We get all Hamiltonians for the specified <code class="docutils literal notranslate"><span class="pre">self.model</span></code></p></li>
<li><p>We find all eigenvalues associated with the Hamiltonians</p></li>
<li><p>For each hamiltonian (id), we count the number of associated entries</p></li>
<li><p>We join the count information with the Hamiltonian information</p></li>
<li><p>We define that a job is done if the numbers of sites is the same as the numbers of eigenvalues</p></li>
<li><p>We add a color column corresponding to the “done” status</p></li>
</ol>
</div>
<div class="section" id="preparing-the-plot">
<h3>Preparing the plot<a class="headerlink" href="#preparing-the-plot" title="Permalink to this headline">¶</a></h3>
<p>Next we create a Bokeh grid plot within the status view class which will take the prepared DataFrame as input</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>

<span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">figure</span>

<span class="k">class</span> <span class="nc">HamiltonianStatusView</span><span class="p">(</span><span class="n">TemplateView</span><span class="p">):</span>

    <span class="o">...</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">prepare_figure</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="s2">&quot;DataFrame&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Figure&quot;</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
            <span class="n">x_axis_location</span><span class="o">=</span><span class="s2">&quot;above&quot;</span><span class="p">,</span>
            <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;hover&quot;</span><span class="p">,</span>
            <span class="n">tooltips</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;Paramaters&quot;</span><span class="p">,</span> <span class="s2">&quot;spacing = @spacing{(0.3f)}, # sites = @n_sites&quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="s2">&quot;@n_level/@n_sites &quot;</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;Interaction&quot;</span><span class="p">,</span> <span class="s2">&quot;c = @c &quot;</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">rect</span><span class="p">(</span>
            <span class="s2">&quot;spacing&quot;</span><span class="p">,</span>
            <span class="s2">&quot;n_sites&quot;</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mf">0.09</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="mf">4.6</span><span class="p">,</span>
            <span class="n">source</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;color&quot;</span><span class="p">,</span>
            <span class="n">legend</span><span class="o">=</span><span class="s2">&quot;done&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">&quot;spacing [fm]&quot;</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label_standoff</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">&quot;# sites&quot;</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label_standoff</span> <span class="o">=</span> <span class="mi">10</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">outline_line_color</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">axis_line_color</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">major_tick_line_color</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">minor_tick_line_color</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="n">fig</span><span class="o">.</span><span class="n">x_range</span><span class="o">.</span><span class="n">range_padding</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">y_range</span><span class="o">.</span><span class="n">range_padding</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">return</span> <span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="section" id="wrapping-things-together">
<h3>Wrapping things together<a class="headerlink" href="#wrapping-things-together" title="Permalink to this headline">¶</a></h3>
<p>To let the template know that we have created a plot, we need to pass the infromation to the context.
Thus we have to update the previously written <code class="docutils literal notranslate"><span class="pre">get_context_data</span></code> method</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">...</span>

<span class="kn">from</span> <span class="nn">bokeh.embed</span> <span class="kn">import</span> <span class="n">components</span>
<span class="kn">from</span> <span class="nn">bokeh</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">bokeh_version</span>

<span class="k">class</span> <span class="nc">HamiltonianStatusView</span><span class="p">(</span><span class="n">TemplateView</span><span class="p">):</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">ContactHamiltonian</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s2">&quot;status.html&quot;</span>

    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_data</span><span class="p">()</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_figure</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">script</span><span class="p">,</span> <span class="n">div</span> <span class="o">=</span> <span class="n">components</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;script&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">script</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;div&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">div</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="n">context</span><span class="p">[</span><span class="s2">&quot;bokeh_version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bokeh_version</span>

        <span class="k">return</span> <span class="n">context</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">bokeh.embed.components</span></code> transforms our figure into html and javascript objects which the webpage can render.
Furthermore, we need the <code class="docutils literal notranslate"><span class="pre">bokeh_version</span></code> to ensure that your Python <code class="docutils literal notranslate"><span class="pre">bokeh</span></code> installation matches the Bokeh javascript version.</p>
<p>Finally, we need to let the template know how to render the plot.
The new <code class="docutils literal notranslate"><span class="pre">status.html</span></code> should look like this</p>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span>{% extends &#39;base.html&#39; %}

{% block head-extra %}
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://cdn.pydata.org/bokeh/release/bokeh-{{bokeh_version}}.min.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;https://cdn.pydata.org/bokeh/release/bokeh-widgets-{{bokeh_version}}.min.css&quot;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/css&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">defer</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.pydata.org/bokeh/release/bokeh-{{bokeh_version}}.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">defer</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.pydata.org/bokeh/release/bokeh-widgets-{{bokeh_version}}.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span> <span class="na">defer</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;https://cdn.pydata.org/bokeh/release/bokeh-tables-{{bokeh_version}}.min.js&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
{% endblock%}

{% block content %}
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;jumbotron&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;&lt;</span><span class="nt">code</span><span class="p">&gt;</span>{{model}}<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span> Status<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h5</span><span class="p">&gt;</span>This page summarizes the status of <span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span>{{model}}<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span> computations<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
        A job is considered done if, for given parameters, one has as many eigenvalues stored in the database as one has sites.
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Grid view of executed jobs<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
    {{div|safe}}
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;container my-4&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Feel free to visit the <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{% url &#39;admin:index&#39; %}&quot;</span><span class="p">&gt;</span>admin page<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span> and add or delete entries for eigenvalues or hamiltonians<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Once entries are missing, you can rerun <span class="p">&lt;</span><span class="nt">code</span><span class="p">&gt;</span>add_data.py<span class="p">&lt;/</span><span class="nt">code</span><span class="p">&gt;</span> to fill up this view again.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
{{script|safe}}
{% endblock %}
</pre></div>
</div>
<p>In the <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">block</span> <span class="pre">head-extra</span> <span class="pre">%}</span></code>, we have loaded the CSS and javascript file version of Bokeh.
We have decided to not included it ourselves (meaning on you machine), as this allows you to install any Bokeh version you like.
But therefore they will be downloaded once you view this page.</p>
<p>Furthermore, we have added the additional <code class="docutils literal notranslate"><span class="pre">|sage</span></code> template filter for <code class="docutils literal notranslate"><span class="pre">{{div|safe}}</span></code> and <code class="docutils literal notranslate"><span class="pre">{{script|safe}}</span></code>.
This means that django should trust this source and actually execute html / javascript statements.
Without that, the template variables would not be rendered and presented as raw code.</p>
<p>If you now visit the status page, you should either see a completely red or completely green status report, depending on if you have run the updated eigenvalues script
<img alt="The new index page" src="../../_images/example-create-status-view-2.png" /></p>
<p>You can now play around and delete some hamiltonians or eigenvalues, e.g., from the admin page and rerun the computation script.</p>
</div>
<div class="section" id="summary">
<h3>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h3>
<p>The final source code for this example can also be found in the <a class="reference external" href="https://github.com/callat-qcd/espressodb/tree/master/example/my_project">EspressoDB repository</a>.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="inheritance.html" class="btn btn-neutral float-right" title="More complicated tables" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="dependencies.html" class="btn btn-neutral float-left" title="Adding tables with relationships" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Christopher Körber, Jason Chang

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>